From: Antonio Radici <antonio@debian.org>
Date: Sun, 14 Aug 2016 22:07:44 +0100
Subject: skip_tests_failing_in_chroot

===================================================================
---
 tests/Makefile.am                                  |  2 +-
 .../acceptance/01_vars/02_functions/network/008.cf | 66 ----------------------
 .../01_vars/02_functions/network/selectservers.cf  | 52 -----------------
 tests/acceptance/01_vars/03_lists/016.cf           | 60 --------------------
 .../templating/timed/expired_edit_line_locks.cf    | 44 ---------------
 tests/acceptance/14_reports/00_output/002.cf       | 47 ---------------
 tests/acceptance/16_cf-serverd/01_start/004.cf     | 19 -------
 tests/unit/Makefile.am                             |  3 -
 8 files changed, 1 insertion(+), 292 deletions(-)
 delete mode 100644 tests/acceptance/01_vars/02_functions/network/008.cf
 delete mode 100644 tests/acceptance/01_vars/02_functions/network/selectservers.cf
 delete mode 100644 tests/acceptance/01_vars/03_lists/016.cf
 delete mode 100644 tests/acceptance/10_files/templating/timed/expired_edit_line_locks.cf
 delete mode 100644 tests/acceptance/14_reports/00_output/002.cf
 delete mode 100644 tests/acceptance/16_cf-serverd/01_start/004.cf

--- a/tests/Makefile.am
+++ b/tests/Makefile.am
@@ -21,4 +21,4 @@
 # (COSL) may apply to this file if you as a licensee so wish it. See
 # included file COSL.txt.
 #
-SUBDIRS = unit load acceptance
+SUBDIRS = unit load
--- a/tests/acceptance/01_vars/02_functions/network/008.cf
+++ /dev/null
@@ -1,66 +0,0 @@
-#######################################################
-#
-# Test host2ip()
-#
-#######################################################
-
-body common control
-{
-      inputs => { "../../../default.cf.sub" };
-      bundlesequence  => { default("$(this.promise_filename)") };
-      version => "1.0";
-}
-
-#######################################################
-
-bundle agent init
-{
-  vars:
-      "dummy" string => "dummy";
-}
-
-#######################################################
-
-bundle agent test
-{
-
-  vars:
-      # Neither of these are likely to change...
-      "localhost" string => host2ip("localhost");
-      "a" string => host2ip("a.root-servers.net");
-}
-
-#######################################################
-
-bundle agent check
-{
-  vars:
-      "localhost" string => "127.0.0.1";
-      "localhost_6" string => "::1";
-      "a" string => "198.41.0.4";
-      "a_6" string => "2001:503:ba3e::2:30";
-
-  classes:
-      "ok_a" or => {
-                     strcmp("$(test.a)", "$(a)"),
-                     strcmp("$(test.a)", "$(a_6)"),
-      };
-      "ok_localhost" or => {
-			     strcmp("$(test.localhost)", "$(localhost)"),
-			     strcmp("$(test.localhost)", "$(localhost_6)"),
-      };
-      "ok" and => {
-                    "ok_a",
-                    "ok_localhost",
-      };
-
-  reports:
-    DEBUG::
-      "Expected $(test.localhost) == $(localhost)";
-      "Expected $(test.a) == ( $(a) or $(a_6) )";
-    ok::
-      "$(this.promise_filename) Pass";
-    !ok::
-      "$(this.promise_filename) FAIL";
-}
-
--- a/tests/acceptance/10_files/templating/timed/expired_edit_line_locks.cf
+++ /dev/null
@@ -1,44 +0,0 @@
-# Check whether file promises have a shorter expiry time than edit_line promises
-# resulting from templates. This will create an empty file because the file is
-# opened for editing, but all the edit_line promises have expired.
-
-body common control
-{
-    inputs => { "../../../dcs.cf.sub", "../../../plucked.cf.sub" };
-    bundlesequence => { default($(this.promise_filename)) };
-}
-
-bundle agent test
-{
-        
-  commands:
-      # Note, no -K, we are testing locks.
-      "$(sys.cf_agent) -v -D AUTO,DEBUG -f $(this.promise_filename).sub"
-        contain => in_shell;
-}
-
-bundle agent check
-{
-  methods:
-    test_pass_1::
-      "any" usebundle => dcs_wait($(this.promise_filename), 70);
-
-  vars:
-    test_pass_2::
-      "content_edit_line" string => readfile("$(G.testfile).edit_line", 10000);
-      "content_cftemplate" string => readfile("$(G.testfile).cftemplate", 10000);
-      "content_mustache" string => readfile("$(G.testfile).mustache", 10000);
-
-  classes:
-    test_pass_2::
-      "ok_edit_line" expression => strcmp($(content_edit_line), "text"),
-        scope => "namespace";
-      "ok_cftemplate" expression => strcmp($(content_cftemplate), "text"),
-        scope => "namespace";
-      "ok_mustache" expression => strcmp($(content_mustache), "text"),
-        scope => "namespace";
-
-  methods:
-    test_pass_2::
-      "any" usebundle => dcs_passif("ok_edit_line.ok_cftemplate.ok_mustache", $(this.promise_filename));
-}
--- a/tests/unit/Makefile.am
+++ b/tests/unit/Makefile.am
@@ -140,7 +140,6 @@
 	files_interfaces_test \
 	refcount_test \
 	list_test \
-	buffer_test \
 	cf_key_functions_test \
 	connection_management_test \
 	expand_test \
@@ -216,18 +215,6 @@
 
 conversion_test_SOURCES = conversion_test.c ../../libpromises/conversion.c
 
-if !BUILTIN_EXTENSIONS
-    check_PROGRAMS += enterprise_extension_test
-
-    enterprise_extension_test_SOURCES = enterprise_extension_test.c
-
-    check_LTLIBRARIES += cfengine-enterprise.la
-    cfengine_enterprise_la_SOURCES = enterprise_extension_test_lib.c
-    cfengine_enterprise_la_LDFLAGS = $(AM_LDFLAGS) \
-	-avoid-version -module -shared -export-dynamic -rpath /
-    EXTRA_enterprise_extension_test_DEPENDENCIES = cfengine-enterprise.la
-endif
-
 set_domainname_test_SOURCES = set_domainname_test.c
 set_domainname_test_LDADD = libstr.la ../../libpromises/libpromises.la
 
--- a/tests/load/Makefile.am
+++ b/tests/load/Makefile.am
@@ -38,15 +38,11 @@
 	-I../../libcfnet \
 	-I../../libpromises
 
-EXTRA_DIST = \
-	run_db_load.sh \
-	run_lastseen_threaded_load.sh
-
-TESTS = \
-	run_db_load.sh \
-	run_lastseen_threaded_load.sh
+EXTRA_DIST = run_db_load.sh
 
-check_PROGRAMS = db_load lastseen_load lastseen_threaded_load
+TESTS = run_db_load.sh
+
+check_PROGRAMS = db_load lastseen_load
 
 
 db_load_SOURCES = db_load.c
@@ -58,6 +54,3 @@
 	$(srcdir)/../../libutils/statistics.c
 lastseen_load_LDADD = ../unit/libdb.la ../../libpromises/libpromises.la
 endif
-
-lastseen_threaded_load_LDADD = ../unit/libtest.la \
-	../../libpromises/libpromises.la
